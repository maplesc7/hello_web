<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Stylish Clock</title>
  <style>
    :root {
      --bg-1: #0f0f14;
      --bg-2: #141821;
      --fg-1: #e8ecf1;
      --glass: rgba(255, 255, 255, 0.08);
      --blur: 18px;
      --ring: rgba(255,255,255,0.14);
      --shadow: 0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.08);
      /* default (cyber) */
      --accent-1:#7df9ff; --accent-2:#ff79c6;
      --glow-1: rgba(125,249,255,.45); --glow-2: rgba(255,121,198,.40);
      --card-grad-1: rgba(125,249,255,.15); --card-grad-2: rgba(255,121,198,.12);
    }

    /* 7テーマ（文字色・背景グロー・カード内グラデを連動） */
    .theme-cyber { --accent-1:#7df9ff; --accent-2:#ff79c6; --glow-1: rgba(125,249,255,.45); --glow-2: rgba(255,121,198,.40); --card-grad-1: rgba(125,249,255,.15); --card-grad-2: rgba(255,121,198,.12); }
    .theme-ink   { --accent-1:#c2c8d0; --accent-2:#6e7a86; --glow-1: rgba(194,200,208,.35); --glow-2: rgba(110,122,134,.30); --card-grad-1: rgba(194,200,208,.16); --card-grad-2: rgba(110,122,134,.10); }
    .theme-sunrise { --accent-1:#ffb86b; --accent-2:#ff6b6b; --glow-1: rgba(255,184,107,.40); --glow-2: rgba(255,107,107,.38); --card-grad-1: rgba(255,184,107,.18); --card-grad-2: rgba(255,107,107,.12); }
    .theme-ocean { --accent-1:#00c9ff; --accent-2:#92fe9d; --glow-1: rgba(0,201,255,.42); --glow-2: rgba(146,254,157,.36); --card-grad-1: rgba(0,201,255,.16); --card-grad-2: rgba(146,254,157,.12); }
    .theme-lava { --accent-1:#ff6a00; --accent-2:#ee0979; --glow-1: rgba(255,106,0,.45); --glow-2: rgba(238,9,121,.38); --card-grad-1: rgba(255,106,0,.16); --card-grad-2: rgba(238,9,121,.12); }
    .theme-forest { --accent-1:#11998e; --accent-2:#38ef7d; --glow-1: rgba(17,153,142,.42); --glow-2: rgba(56,239,125,.34); --card-grad-1: rgba(17,153,142,.16); --card-grad-2: rgba(56,239,125,.12); }
    .theme-royal { --accent-1:#8360c3; --accent-2:#2ebf91; --glow-1: rgba(131,96,195,.42); --glow-2: rgba(46,191,145,.34); --card-grad-1: rgba(131,96,195,.16); --card-grad-2: rgba(46,191,145,.12); }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }

    body {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      color: var(--fg-1);
      background: linear-gradient(160deg, var(--bg-1), var(--bg-2));
      background-attachment: fixed;
      display: grid; place-items: center; overflow: hidden;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    /* 背景ぼかし（テーマ連動） */
    body::before {
      content: ""; position: fixed; inset: -20%; pointer-events: none; z-index: -1;
      background:
        radial-gradient(40% 28% at 86% 12%, var(--glow-2) 0%, transparent 60%),
        radial-gradient(40% 28% at 12% 88%, var(--glow-1) 0%, transparent 60%);
      filter: blur(26px);
    }

    /* ===== レイアウト ===== */
    .stage { position: relative; width: min(92vw, 760px); aspect-ratio: 1/2; }

    /* ガラス（カード）だけを斜めにする */
    .glass-card {
      position: absolute; inset: 0; border-radius: 28px; overflow: hidden; z-index: 1;
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(var(--blur)) saturate(1.15); -webkit-backdrop-filter: blur(var(--blur)) saturate(1.15);
      box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,.10);
      transform: rotate(3deg); /* 右上→左下へ傾ける */
    }
    .glass-card::before{ /* 薄い内部グラデ（テーマ連動） */
      content:""; position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)),
                  linear-gradient(120deg, var(--card-grad-1), var(--card-grad-2));
    }

    /* 時計（水平のまま） */
    .hud { position: absolute; inset: 0; z-index: 2; display: grid; grid-template-rows: 1fr auto auto 1fr; }
    .time-wrap { align-self: start; justify-self: center; margin-top: 13%; width: 86%; }
    .time {
      font-weight: 800; letter-spacing: -0.03em; font-variant-numeric: tabular-nums lining-nums;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; color: transparent;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.35));
      white-space: nowrap; display: inline-block;
      /* フォントサイズはJSでfit */
      font-size: 14vh;
    }
    .date { align-self: start; justify-self: center; margin-top: 12px; font-size: clamp(14px, 2.2vh, 20px); font-weight: 600; opacity: .92; }

    /* 画面下の説明書き */
    .hints { position: fixed; left: 0; right: 0; bottom: max(10px, env(safe-area-inset-bottom)); text-align: center; font-size: 12px; opacity: .65; z-index: 3; }

    /* 設定ダイアログ */
    dialog#settings { border: none; padding: 0; background: transparent; }
    .sheet {
      width: min(92vw, 720px); margin: 0 auto; color: var(--fg-1);
      background: var(--glass); backdrop-filter: blur(14px) saturate(1.1); -webkit-backdrop-filter: blur(14px) saturate(1.1);
      border: 1px solid rgba(255,255,255,.12); border-radius: 20px; box-shadow: var(--shadow); padding: 18px;
    }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; padding: 10px 6px; }
    .row + .row { border-top: 1px solid rgba(255,255,255,.08); }
    .row label { font-size: 14px; opacity: .9; }
    .row .seg { display: inline-grid; grid-auto-flow: column; gap: 6px; }
    button, .seg > button { appearance: none; border: 1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); color: var(--fg-1); border-radius: 12px; padding: 10px 12px; font-size: 14px; }
    .seg > button[aria-pressed="true"]{ background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); color: #0a0b0f; font-weight: 700; }
    .footer { display: flex; justify-content: flex-end; gap: 8px; margin-top: 12px; }
  </style>
</head>
<body class="theme-cyber">
  <div class="stage" id="stage">
    <div class="glass-card" aria-hidden="true"></div>
    <div class="hud">
      <div class="time-wrap"><div class="time" id="time">00:00</div></div>
      <div class="date" id="date">1970-01-01 Thu</div>
    </div>
  </div>
  <div class="hints">ダブルタップ: テーマ変更 / 長押し: 設定</div>

  <dialog id="settings">
    <form method="dialog" class="sheet">
      <div class="row">
        <label>時間表示</label>
        <div class="seg">
          <button type="button" id="b12" aria-pressed="false">12時間</button>
          <button type="button" id="b24" aria-pressed="true">24時間</button>
        </div>
      </div>
      <div class="row">
        <label>日付</label>
        <div class="seg">
          <button type="button" id="dateOn" aria-pressed="true">表示</button>
          <button type="button" id="dateOff" aria-pressed="false">非表示</button>
        </div>
      </div>
      <div class="row">
        <label>テーマ</label>
        <div class="seg">
          <button type="button" data-theme="theme-cyber" aria-pressed="true">CYBER</button>
          <button type="button" data-theme="theme-ink" aria-pressed="false">INK</button>
          <button type="button" data-theme="theme-sunrise" aria-pressed="false">SUNRISE</button>
          <button type="button" data-theme="theme-ocean" aria-pressed="false">OCEAN</button>
          <button type="button" data-theme="theme-lava" aria-pressed="false">LAVA</button>
          <button type="button" data-theme="theme-forest" aria-pressed="false">FOREST</button>
          <button type="button" data-theme="theme-royal" aria-pressed="false">ROYAL</button>
        </div>
      </div>
      <div class="footer">
        <button value="cancel">閉じる</button>
        <button id="reset">初期化</button>
      </div>
    </form>
  </dialog>

  <script>
    const elTime = document.getElementById('time');
    const elDate = document.getElementById('date');
    const stage = document.getElementById('stage');
    const card = document.querySelector('.glass-card');
    const sheet = document.getElementById('settings');

    const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    const storeKey = 'stylish-clock:v2';
    const state = { use24h: true, showDate: true, theme: 'theme-cyber' };
    try { Object.assign(state, JSON.parse(localStorage.getItem(storeKey)||'{}')); } catch {}

    function pad(n){ return n<10 ? '0'+n : ''+n; }
    function formatDate(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${weekdays[d.getDay()]}`; }

    let lastMinute = -1;
    function render(){
      const d = new Date();
      let h = d.getHours();
      if(!state.use24h){ h = h%12 || 12; }
      const text = `${pad(h)}:${pad(d.getMinutes())}` + (state.use24h ? '' : (d.getHours()>=12?' PM':' AM'));
      elTime.textContent = text;
      elDate.textContent = state.showDate ? formatDate(d) : '';
      if(lastMinute !== d.getMinutes()){ lastMinute = d.getMinutes(); fitText(); }
    }

    // 時刻のフォントサイズをカード幅に自動フィット
    function fitText(){
      const wrapWidth = Math.min(stage.clientWidth * 0.86, 760 * 0.86);
      let size = Math.min(window.innerHeight * 0.22, wrapWidth * 0.36); // 安全上限
      elTime.style.fontSize = size + 'px';
      // 少し余白を残してフィット
      const guardMax = 40; let guard = 0;
      while(elTime.scrollWidth > wrapWidth && guard++ < guardMax){
        size -= 2; elTime.style.fontSize = size + 'px';
      }
    }

    setInterval(render, 1000); render(); fitText();
    addEventListener('resize', fitText);

    // ジェスチャ
    let lastTap = 0, pressTimer;
    stage.addEventListener('touchend', () => { const now = Date.now(); if(now - lastTap < 300){ cycleTheme(); } lastTap = now; });
    stage.addEventListener('pointerdown', () => { pressTimer = setTimeout(()=>{ sheet.showModal(); syncUI(); }, 500); });
    stage.addEventListener('pointerup', () => clearTimeout(pressTimer));

    function cycleTheme(){
      const themes = ['theme-cyber','theme-ink','theme-sunrise','theme-ocean','theme-lava','theme-forest','theme-royal'];
      const idx = themes.indexOf(state.theme); state.theme = themes[(idx+1)%themes.length];
      document.body.className = state.theme; save();
    }

    function syncUI(){
      b12.setAttribute('aria-pressed', String(!state.use24h));
      b24.setAttribute('aria-pressed', String(state.use24h));
      dateOn.setAttribute('aria-pressed', String(state.showDate));
      dateOff.setAttribute('aria-pressed', String(!state.showDate));
      document.querySelectorAll('[data-theme]').forEach(b=>b.setAttribute('aria-pressed', String(b.dataset.theme===state.theme)));
    }
    function save(){ localStorage.setItem(storeKey, JSON.stringify(state)); }

    b12.addEventListener('click', ()=>{ state.use24h=false; save(); syncUI(); render(); fitText(); });
    b24.addEventListener('click', ()=>{ state.use24h=true; save(); syncUI(); render(); fitText(); });
    dateOn.addEventListener('click', ()=>{ state.showDate=true; save(); syncUI(); render(); });
    dateOff.addEventListener('click', ()=>{ state.showDate=false; save(); syncUI(); render(); });
    document.querySelectorAll('[data-theme]').forEach(btn=>btn.addEventListener('click', ()=>{ state.theme = btn.dataset.theme; document.body.className = state.theme; save(); syncUI(); }));
    reset.addEventListener('click',(e)=>{ e.preventDefault(); Object.assign(state,{use24h:true,showDate:true,theme:'theme-cyber'}); document.body.className = state.theme; save(); syncUI(); render(); fitText(); });

    // 初期テーマ反映
    document.body.className = state.theme;
  </script>
</body>
</html>
