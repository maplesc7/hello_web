<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no"
  />
  <title>Minute Vapor Timer</title>
  <style>
    /* ===================== VARIABLES ===================== */
    :root {
      --bg1: #0e0e1a;
      --bg2: #1a1a2e;
      --glow: #ff45ff;
      --glow2: #45e6ff;
      --text: #ffffff;
      --wire-main: rgba(255, 255, 255, 0.9);
      --wire-sub: rgba(255, 255, 255, 0.5);
      --floor-grid-main: rgba(255, 69, 255, 0.7);
      --floor-grid-accent: rgba(69, 230, 255, 0.65);

      --panel-bg: rgba(0, 0, 0, 0.55);
      --panel-border: rgba(255, 255, 255, 0.28);
      --panel-blur: 14px;
      --accent: rgba(255,255,255,0.95);
      --accent-soft: rgba(255,255,255,0.7);
      --btn-bg: rgba(255,255,255,0.06);
      --btn-bg-hover: rgba(255,255,255,0.12);
      --btn-border: rgba(255,255,255,0.22);
      --danger: #ff6b6b;
      --ok: #7dffb3;
    }

    /* ===================== RESET & BASE ===================== */
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont,
        sans-serif;
      color: var(--text);
      background: var(--bg1);
      -webkit-text-size-adjust: 100%;
      overflow-x: hidden;
    }

    body {
      min-height: 100vh;
      min-height: 100svh;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      padding-bottom: env(safe-area-inset-bottom, 0px);
      background:
        radial-gradient(circle at top, rgba(255, 255, 255, 0.12), transparent 55%),
        radial-gradient(circle at bottom, rgba(0, 0, 0, 0.9), var(--bg1));
    }

    /* ===================== SCENE & FLOOR GRID ===================== */
    .scene {
      position: relative;
      width: 100%;
      max-width: 100vw;
      min-height: 100vh;
      min-height: 100svh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-sizing: border-box;
      padding-bottom: max(0px, env(safe-area-inset-bottom, 0px));
      background:
        radial-gradient(circle at top, var(--bg2), var(--bg1) 45%),
        radial-gradient(circle at bottom, #000000, var(--bg1));
    }

    .scene-grid {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 0;
    }

    /* ÁîªÈù¢‰∏ã 1/3 ‰ªòËøë„Çí„Åó„Å£„Åã„ÇäË¶Ü„ÅÜ„Éï„É≠„Ç¢„Ç∞„É™„ÉÉ„Éâ */
    .scene-grid::before {
      content: "";
      position: absolute;
      left: -24%;
      right: -24%;
      bottom: -18%;
      height: 65vh;
      background-image:
        /* Â••„Å´Âêë„Åã„Å£„Å¶Ê∑°„Åè„Å™„ÇãÁô∫ÂÖâ„Éô„Éº„Çπ */
        linear-gradient(
          to top,
          rgba(0, 0, 0, 0.9) 0%,
          rgba(0, 0, 0, 0.55) 18%,
          rgba(255, 255, 255, 0.08) 55%,
          transparent 100%
        ),
        /* Ê®™„É©„Ç§„É≥ÔºàÊâãÂâçÂØÑ„Çä„Éû„Çº„É≥„ÇøÔºâ */
        repeating-linear-gradient(
          to right,
          var(--floor-grid-main) 0,
          var(--floor-grid-main) 1.2px,
          transparent 1.2px,
          transparent 34px
        ),
        /* Â••Ë°å„Åç„É©„Ç§„É≥Ôºà„Ç∑„Ç¢„É≥Ôºè„Ç¢„ÇØ„Çª„É≥„ÉàÔºâ */
        repeating-linear-gradient(
          to top,
          var(--floor-grid-accent) 0,
          var(--floor-grid-accent) 1.2px,
          transparent 1.2px,
          transparent 36px
        );
      opacity: 0.8;
      transform-origin: bottom center;
      transform: perspective(900px) rotateX(70deg);
      filter: blur(0.35px);
      mix-blend-mode: screen;
    }

    /* ===================== CLOCK / TIMER DISPLAY ===================== */
    .clock {
      position: relative;
      z-index: 1;
      font-size: clamp(110px, 24vw, 230px);
      font-weight: 600;
      letter-spacing: -0.04em;
      line-height: 1;
      text-shadow:
        0 0 24px var(--glow),
        0 0 48px var(--glow2),
        0 0 80px rgba(0, 0, 0, 0.9);
      user-select: none;
      pointer-events: none;
      transform: translateY(-6vh);
      animation: pulse 6s ease-in-out infinite;
      white-space: nowrap;
    }

    .clock small {
      font-size: 0.28em;
      font-weight: 500;
      opacity: 0.9;
      margin-left: 0.1em;
      letter-spacing: 0;
    }

    @keyframes pulse {
      0%,
      100% {
        opacity: 1;
        filter: hue-rotate(0deg);
      }
      50% {
        opacity: 0.85;
        filter: hue-rotate(18deg);
      }
    }

    @media (max-height: 700px) {
      .clock {
        font-size: clamp(96px, 22vw, 210px);
        transform: translateY(-4vh);
      }
    }

    /* ===================== THEMES ===================== */
    [data-theme="cyber"] {
      --bg1: #00110f;
      --bg2: #003b36;
      --glow: #00ffaa;
      --glow2: #00ccff;
      --text: #eaffff;
      --wire-main: rgba(0, 255, 170, 0.95);
      --wire-sub: rgba(0, 204, 255, 0.7);
      --floor-grid-main: rgba(0, 255, 170, 0.78);
      --floor-grid-accent: rgba(0, 204, 255, 0.7);

      --panel-bg: rgba(0, 0, 0, 0.45);
    }

    [data-theme="sunset"] {
      --bg1: #1a0d0d;
      --bg2: #4d1a1a;
      --glow: #ff6b6b;
      --glow2: #ffcc66;
      --text: #ffe6e6;
      --wire-main: rgba(255, 107, 107, 0.95);
      --wire-sub: rgba(255, 204, 102, 0.7);
      --floor-grid-main: rgba(255, 107, 107, 0.8);
      --floor-grid-accent: rgba(255, 204, 102, 0.72);
    }

    [data-theme="ocean"] {
      --bg1: #020817;
      --bg2: #012a4a;
      --glow: #00b4ff;
      --glow2: #38bdf8;
      --text: #e0f2fe;
      --wire-main: rgba(56, 189, 248, 0.95);
      --wire-sub: rgba(37, 99, 235, 0.7);
      --floor-grid-main: rgba(56, 189, 248, 0.8);
      --floor-grid-accent: rgba(37, 99, 235, 0.72);
    }

    [data-theme="violet"] {
      --bg1: #120021;
      --bg2: #2a0a4a;
      --glow: #c471ff;
      --glow2: #7f00ff;
      --text: #f5e9ff;
      --wire-main: rgba(196, 113, 255, 0.95);
      --wire-sub: rgba(127, 0, 255, 0.7);
      --floor-grid-main: rgba(196, 113, 255, 0.8);
      --floor-grid-accent: rgba(127, 0, 255, 0.7);
    }

    [data-theme="amber"] {
      --bg1: #1b1204;
      --bg2: #4a2600;
      --glow: #ffb347;
      --glow2: #ffcc33;
      --text: #fff4dd;
      --wire-main: rgba(255, 179, 71, 0.95);
      --wire-sub: rgba(255, 204, 51, 0.75);
      --floor-grid-main: rgba(255, 179, 71, 0.82);
      --floor-grid-accent: rgba(255, 204, 51, 0.75);
    }

    [data-theme="mono"] {
      --bg1: #050506;
      --bg2: #141414;
      --glow: #f5f5f5;
      --glow2: #9e9e9e;
      --text: #f5f5f5;
      --wire-main: rgba(245, 245, 245, 0.9);
      --wire-sub: rgba(158, 158, 158, 0.6);
      --floor-grid-main: rgba(245, 245, 245, 0.7);
      --floor-grid-accent: rgba(158, 158, 158, 0.65);
    }

    /* ===================== THEME PANEL UI ===================== */
    .theme-toggle {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 16px);
      right: 16px;
      width: 44px;
      height: 44px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      backdrop-filter: blur(var(--panel-blur));
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      z-index: 10;
      -webkit-tap-highlight-color: transparent;
    }

    .theme-panel {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 76px);
      right: 16px;
      width: 230px;
      max-width: calc(100vw - 32px);
      background: rgba(6, 10, 30, 0.96);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.24);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
      padding: 10px 12px 12px;
      backdrop-filter: blur(20px);
      z-index: 11;
      display: none;
    }

    .theme-panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
      opacity: 0.9;
    }

    .theme-close {
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      padding: 0 4px;
      -webkit-tap-highlight-color: transparent;
    }

    .theme-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .theme-chip {
      flex: 0 0 calc(50% - 3px);
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.28);
      background: rgba(255, 255, 255, 0.03);
      font-size: 11px;
      color: #fff;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .theme-chip-swatch {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      flex-shrink: 0;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
    }

    .theme-chip.active {
      border-color: #ffffff;
      background: rgba(255, 255, 255, 0.08);
    }

    /* ===================== TIMER CONTROLS ===================== */
    .controls {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 14px);
      left: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 14px;
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      backdrop-filter: blur(var(--panel-blur));
      z-index: 10;
      box-shadow: 0 10px 28px rgba(0,0,0,0.55);
      -webkit-tap-highlight-color: transparent;
    }

    .ctrl-btn {
      appearance: none;
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: background .15s ease, border-color .15s ease, transform .08s ease;
      min-width: 64px;
      text-align: center;
    }

    .ctrl-btn:hover { background: var(--btn-bg-hover); }
    .ctrl-btn:active { transform: translateY(1px) scale(0.98); }

    .ctrl-btn.primary {
      border-color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.12);
    }

    .ctrl-btn.stop {
      border-color: color-mix(in srgb, var(--danger) 60%, white 0%);
      color: #fff;
    }

    .ctrl-btn.reset {
      border-color: rgba(255,255,255,0.18);
      opacity: 0.85;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.35);
      box-shadow: 0 0 8px rgba(255,255,255,0.35);
      margin-right: 2px;
    }

    .status-dot.running {
      background: var(--ok);
      box-shadow: 0 0 10px color-mix(in srgb, var(--ok) 70%, white 0%);
    }

    .status-text {
      font-size: 11px;
      opacity: 0.85;
      margin-right: 6px;
      user-select: none;
      white-space: nowrap;
    }

    /* ===================== SMALL SCREEN TWEAKS ===================== */
    @media (max-width: 480px) {
      .theme-panel {
        bottom: calc(env(safe-area-inset-bottom, 0px) + 72px);
        right: 12px;
        left: 12px;
        margin: 0 auto;
      }

      .theme-toggle {
        right: 12px;
      }

      .controls {
        left: 10px;
        right: 70px; /* allow space for theme button */
        justify-content: space-between;
      }

      .ctrl-btn {
        min-width: 58px;
        padding: 8px 10px;
      }
    }
  </style>
</head>
<body>
  <div class="scene">
    <div class="scene-grid"></div>

    <!-- ÂàÜ„Å†„Åë„ÅÆ„Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„ÉóË°®Á§∫ -->
    <div class="clock" id="clock">
      <span id="minuteValue">0</span><small>ÂàÜ</small>
    </div>

    <!-- „Çø„Ç§„Éû„ÉºÊìç‰Ωú -->
    <div class="controls" role="group" aria-label="„Çø„Ç§„Éû„ÉºÊìç‰Ωú">
      <span class="status-dot" id="statusDot" aria-hidden="true"></span>
      <span class="status-text" id="statusText">ÂÅúÊ≠¢‰∏≠</span>

      <button class="ctrl-btn primary" id="startBtn" type="button">
        „Çπ„Çø„Éº„Éà
      </button>
      <button class="ctrl-btn stop" id="stopBtn" type="button" disabled>
        „Çπ„Éà„ÉÉ„Éó
      </button>
      <button class="ctrl-btn reset" id="resetBtn" type="button">
        „É™„Çª„ÉÉ„Éà
      </button>
    </div>

    <!-- „ÉÜ„Éº„Éû -->
    <button
      class="theme-toggle"
      id="themeToggle"
      type="button"
      aria-label="„ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà"
    >
      üé®
    </button>

    <div class="theme-panel" id="themePanel">
      <div class="theme-panel-header">
        <span>„ÉÜ„Éº„ÉûÈÅ∏Êäû</span>
        <button type="button" class="theme-close" id="themeClose">√ó</button>
      </div>
      <div class="theme-list" id="themeList"></div>
    </div>
  </div>

  <script>
    /* =========================================================
       Minute-only Count Up Timer
       - Áßí„ÅØË°®Á§∫„Åó„Å™„ÅÑ
       - 0ÂàÜ„Åã„ÇâÈñãÂßã
       - ÁµåÈÅéÊôÇÈñì„ÅØ Date.now() „Éô„Éº„Çπ„ÅßË®àÁÆó„Åó„Å¶„Ç∫„É¨„ÇíÊúÄÂ∞èÂåñ
       - Áä∂ÊÖã„Çí localStorage „Å´‰øùÂ≠òÔºà„É™„É≠„Éº„Éâ„ÇÑPWAÂåñ„Åß„ÇÇÂÆâÂøÉÔºâ
    ========================================================= */

    const minuteValueEl = document.getElementById("minuteValue");
    const statusDotEl   = document.getElementById("statusDot");
    const statusTextEl  = document.getElementById("statusText");
    const startBtn      = document.getElementById("startBtn");
    const stopBtn       = document.getElementById("stopBtn");
    const resetBtn      = document.getElementById("resetBtn");

    const STORAGE_KEY = "minute-vapor-timer:v1";

    let state = {
      running: false,
      startEpochMs: null,   // runningÈñãÂßãÊôÇÂàª
      elapsedMs: 0          // ÂÅúÊ≠¢‰∏≠„Å´‰øùÊåÅ„Åô„ÇãÁ¥ØÁ©çÁµåÈÅé
    };

    let tickHandle = null;

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (
          typeof parsed === "object" &&
          parsed &&
          typeof parsed.running === "boolean" &&
          (parsed.startEpochMs === null || Number.isFinite(parsed.startEpochMs)) &&
          Number.isFinite(parsed.elapsedMs)
        ) {
          state = parsed;
        }
      } catch (_) {}
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (_) {}
    }

    function nowElapsedMs() {
      if (!state.running) return state.elapsedMs;
      if (!state.startEpochMs) return state.elapsedMs;
      const delta = Date.now() - state.startEpochMs;
      return Math.max(0, state.elapsedMs + delta);
    }

    function render() {
      const ms = nowElapsedMs();
      const minutes = Math.floor(ms / 60000);
      minuteValueEl.textContent = String(minutes);

      statusDotEl.classList.toggle("running", state.running);
      statusTextEl.textContent = state.running ? "Ë®àÊ∏¨‰∏≠" : "ÂÅúÊ≠¢‰∏≠";

      startBtn.disabled = state.running;
      stopBtn.disabled  = !state.running;
    }

    // Ê¨°„ÅÆ„ÄåÂàÜ„Äç„ÅåÂ§â„Çè„ÇãÁõ¥Ââç„Å´ÂÜçÊèèÁîª„Åô„Çã„Åü„ÇÅ„ÅÆ„Çø„Ç§„Éû„Éº
    function scheduleTick() {
      if (tickHandle) {
        clearTimeout(tickHandle);
        tickHandle = null;
      }
      if (!state.running) return;

      const ms = nowElapsedMs();
      const remainder = ms % 60000;
      const wait = Math.max(250, 60000 - remainder); // ÂÆâÂÖ®„Éû„Éº„Ç∏„É≥
      tickHandle = setTimeout(() => {
        render();
        scheduleTick();
      }, wait);
    }

    function start() {
      if (state.running) return;

      // Êó¢„Å´elapsedMs„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄåÂÜçÈñã„Äç
      state.running = true;
      state.startEpochMs = Date.now();
      saveState();
      render();
      scheduleTick();
    }

    function stop() {
      if (!state.running) return;

      // ‰ªä„Åæ„Åß„ÅÆÁµåÈÅé„ÇíelapsedMs„Å´Á¢∫ÂÆö
      state.elapsedMs = nowElapsedMs();
      state.running = false;
      state.startEpochMs = null;
      saveState();

      if (tickHandle) {
        clearTimeout(tickHandle);
        tickHandle = null;
      }
      render();
    }

    function reset() {
      state.running = false;
      state.startEpochMs = null;
      state.elapsedMs = 0;
      saveState();

      if (tickHandle) {
        clearTimeout(tickHandle);
        tickHandle = null;
      }
      render();
    }

    startBtn.addEventListener("click", start);
    stopBtn.addEventListener("click", stop);
    resetBtn.addEventListener("click", reset);

    // ÂàùÊúüÂåñ
    loadState();
    render();
    if (state.running) {
      // „É™„É≠„Éº„Éâ‰∏≠„Å´ÁµåÈÅé„Åå‰º∏„Å≥„Çã„ÅÆ„ÇíÊ≠£„Åó„ÅèÂèçÊò†„Åô„Çã
      scheduleTick();
    }

    // ÁîªÈù¢„ÅåÂæ©Â∏∞„Åó„Åü„ÇâÂÜçÊèèÁîªÔºà„Çπ„Éû„Éõ„ÅÆ„Çπ„É™„Éº„ÉóÂæ©Â∏∞ÂØæÁ≠ñÔºâ
    document.addEventListener("visibilitychange", () => {
      if (!document.hidden) {
        render();
        scheduleTick();
      }
    });

    /* ===================== THEME SWITCH (from your sample) ===================== */
    const themeDefs = [
      { id: "default", label: "Vapor Pink", swatch: "linear-gradient(135deg,#ff3ea5,#ffb200)" },
      { id: "cyber",   label: "Cyber Green", swatch: "linear-gradient(135deg,#00ffaa,#00ccff)" },
      { id: "sunset",  label: "Sunset Orange", swatch: "linear-gradient(135deg,#ff6b6b,#ffcc66)" },
      { id: "ocean",   label: "Deep Ocean",   swatch: "linear-gradient(135deg,#00b4ff,#0044ff)" },
      { id: "violet",  label: "Neon Violet",  swatch: "linear-gradient(135deg,#c471ff,#7f00ff)" },
      { id: "amber",   label: "Warm Amber",   swatch: "linear-gradient(135deg,#ffb347,#ffcc33)" },
      { id: "mono",    label: "Soft Mono",    swatch: "linear-gradient(135deg,#f5f5f5,#777777)" }
    ];

    const rootEl   = document.documentElement;
    const panelEl  = document.getElementById("themePanel");
    const toggleEl = document.getElementById("themeToggle");
    const closeEl  = document.getElementById("themeClose");
    const listEl   = document.getElementById("themeList");

    const THEME_KEY = "minute-vapor-theme:v1";

    function applyTheme(id) {
      if (id === "default") {
        rootEl.removeAttribute("data-theme");
      } else {
        rootEl.setAttribute("data-theme", id);
      }
      try { localStorage.setItem(THEME_KEY, id); } catch (_) {}

      listEl.querySelectorAll(".theme-chip").forEach(chip => {
        chip.classList.toggle("active", chip.dataset.themeId === id);
      });
    }

    function loadTheme() {
      try {
        const id = localStorage.getItem(THEME_KEY);
        if (id) return id;
      } catch (_) {}
      return "default";
    }

    function buildThemeList() {
      const frag = document.createDocumentFragment();
      themeDefs.forEach(theme => {
        const chip = document.createElement("button");
        chip.type = "button";
        chip.className = "theme-chip";
        chip.dataset.themeId = theme.id;

        const swatch = document.createElement("span");
        swatch.className = "theme-chip-swatch";
        swatch.style.background = theme.swatch;

        const label = document.createElement("span");
        label.textContent = theme.label;

        chip.appendChild(swatch);
        chip.appendChild(label);
        chip.addEventListener("click", () => applyTheme(theme.id));

        frag.appendChild(chip);
      });
      listEl.innerHTML = "";
      listEl.appendChild(frag);
    }

    buildThemeList();
    applyTheme(loadTheme());

    toggleEl.addEventListener("click", () => {
      const showing = panelEl.style.display === "block";
      panelEl.style.display = showing ? "none" : "block";
    });

    closeEl.addEventListener("click", () => {
      panelEl.style.display = "none";
    });

    document.addEventListener("click", (event) => {
      if (
        panelEl.style.display === "block" &&
        !panelEl.contains(event.target) &&
        event.target !== toggleEl
      ) {
        panelEl.style.display = "none";
      }
    });
  </script>
</body>
</html>
