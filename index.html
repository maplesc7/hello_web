<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Stylish Clock</title>
  <style>
    :root {
      --bg-1: #0f0f14;
      --bg-2: #141821;
      --fg-1: #e8ecf1;
      --accent-1: #7df9ff; /* cyber cyan */
      --accent-2: #ff79c6; /* neon magenta */
      --glass: rgba(255, 255, 255, 0.08);
      --blur: 18px;
      --ring: rgba(255,255,255,0.14);
      --shadow: 0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.08);
    }
    
    /* Themes */
    .theme-cyber { --accent-1:#7df9ff; --accent-2:#ff79c6; }
    .theme-ink   { --accent-1:#c2c8d0; --accent-2:#6e7a86; }
    .theme-sunrise { --accent-1:#ffb86b; --accent-2:#ff6b6b; }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      color: var(--fg-1);
      background: radial-gradient(120% 80% at 80% 0%, var(--accent-2) 0%, transparent 40%),
                  radial-gradient(120% 80% at 0% 100%, var(--accent-1) 0%, transparent 40%),
                  linear-gradient(160deg, var(--bg-1), var(--bg-2));
      background-attachment: fixed;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    .safe {
      padding: constant(safe-area-inset-top) constant(safe-area-inset-right)
               constant(safe-area-inset-bottom) constant(safe-area-inset-left);
      padding: env(safe-area-inset-top) env(safe-area-inset-right)
               env(safe-area-inset-bottom) env(safe-area-inset-left);
      display: grid;
      place-items: center;
      height: 100dvh;
      position: relative;
    }

    .clock-card {
      position: relative;
      width: min(92vw, 760px);
      aspect-ratio: 1 / 2; /* ほぼ1:2の比率に最適化 */
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      backdrop-filter: blur(var(--blur)) saturate(1.15);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(1.15);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.10);
      isolation: isolate;
    }

    /* 装飾リング */
    .clock-card::before {
      content: "";
      position: absolute; inset: 0;
      background:
        radial-gradient(60% 20% at 50% -10%, rgba(255,255,255,.35), transparent 60%),
        conic-gradient(from 180deg at 50% 50%, var(--ring), transparent 40%, var(--ring) 60%, transparent 75%);
      mix-blend-mode: overlay;
      pointer-events: none;
    }

    .content {
      height: 100%; width: 100%;
      display: grid;
      grid-template-rows: 1fr auto 1fr; /* 上余白 / 時計 / 下余白 */
      padding: 4vh 4vw;
      position: relative;
    }

    .now {
      align-self: center;
      justify-self: center;
      letter-spacing: -0.02em;
      font-variant-numeric: tabular-nums lining-nums;
      line-height: 0.94;
      display: grid; gap: 0.7vh;
      text-align: center;
      filter: drop-shadow(0 2px 10px rgba(0,0,0,.35));
      user-select: none;
    }

    .time {
      font-weight: 700;
      /* 画面にあわせてダイナミックに拡大。1:2 縦長に最適化 */
      font-size: clamp(48px, min(14vh, 18vw), 160px);
      letter-spacing: -0.03em;
      background: linear-gradient( 90deg, var(--accent-1), var(--accent-2) );
      -webkit-background-clip: text; background-clip: text;
      -webkit-text-fill-color: transparent; color: transparent;
    }

    .secs { opacity: .85; }

    .date {
      font-size: clamp(14px, 2.2vh, 20px);
      font-weight: 500;
      opacity: 0.92;
    }

    .status {
      position: absolute; top: 10px; left: 12px; right: 12px;
      display: flex; justify-content: space-between; align-items: center;
      font-size: 12px; letter-spacing: .06em; text-transform: uppercase;
      opacity: .7;
    }

    .hints {
      position: absolute; bottom: 14px; left: 0; right: 0;
      text-align: center; opacity: .6; font-size: 12px;
    }

    .glow {
      position: absolute; inset: 0; pointer-events: none; mix-blend-mode: screen; opacity: .55;
      background:
        radial-gradient(40% 20% at 50% 0%, rgba(125,249,255,.4), transparent 60%),
        radial-gradient(40% 20% at 50% 100%, rgba(255,121,198,.35), transparent 60%);
      filter: blur(22px);
    }

    /* 設定シート */
    dialog#settings {
      border: none; padding: 0; background: transparent;
    }
    .sheet {
      width: min(92vw, 720px);
      margin: 0 auto;
      background: var(--glass);
      backdrop-filter: blur(14px) saturate(1.1);
      -webkit-backdrop-filter: blur(14px) saturate(1.1);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      border-radius: 20px;
      padding: 18px;
      color: var(--fg-1);
    }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; padding: 10px 6px; }
    .row + .row { border-top: 1px solid rgba(255,255,255,.08); }
    .row label { font-size: 14px; opacity: .9; }
    .row .seg { display: inline-grid; grid-auto-flow: column; gap: 6px; }
    button, .seg > button {
      appearance: none; border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--fg-1); border-radius: 12px; padding: 10px 12px; font-size: 14px;
    }
    button:hover{ filter: brightness(1.05); }
    .seg > button[aria-pressed="true"]{ background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); color: #0a0b0f; font-weight: 700; }

    .footer { display: flex; justify-content: flex-end; gap: 8px; margin-top: 12px; }

    @media (prefers-color-scheme: light) {
      :root { --fg-1:#0e1014; --glass: rgba(255,255,255,0.56); --ring: rgba(0,0,0,.10); }
      .sheet { background: rgba(255,255,255,0.85); }
    }

    @media (prefers-reduced-motion: reduce) {
      .glow, .clock-card::before { display: none; }
    }
  </style>
</head>
<body class="theme-cyber">
  <div class="safe">
    <div class="clock-card" id="card">
      <div class="status"><span id="themeLabel">CYBER</span><span id="fmtLabel">24H</span></div>
      <div class="content">
        <div></div>
        <div class="now" id="now">
          <div class="time" id="time">00:00<span class="secs" id="secs">:00</span></div>
          <div class="date" id="date">1970-01-01 Thu</div>
        </div>
        <div></div>
      </div>
      <div class="hints">タップ: 秒の表示 / ダブルタップ: テーマ変更 / 長押し: 設定</div>
      <div class="glow"></div>
    </div>
  </div>

  <dialog id="settings">
    <form method="dialog" class="sheet">
      <div class="row">
        <label>時間表示</label>
        <div class="seg">
          <button type="button" id="b12" aria-pressed="false">12時間</button>
          <button type="button" id="b24" aria-pressed="true">24時間</button>
        </div>
      </div>
      <div class="row">
        <label>秒</label>
        <div class="seg">
          <button type="button" id="bSecOn" aria-pressed="true">表示</button>
          <button type="button" id="bSecOff" aria-pressed="false">非表示</button>
        </div>
      </div>
      <div class="row">
        <label>日付</label>
        <div class="seg">
          <button type="button" id="bDateOn" aria-pressed="true">表示</button>
          <button type="button" id="bDateOff" aria-pressed="false">非表示</button>
        </div>
      </div>
      <div class="row">
        <label>テーマ</label>
        <div class="seg">
          <button type="button" data-theme="theme-cyber" aria-pressed="true">CYBER</button>
          <button type="button" data-theme="theme-ink" aria-pressed="false">INK</button>
          <button type="button" data-theme="theme-sunrise" aria-pressed="false">SUNRISE</button>
        </div>
      </div>
      <div class="footer">
        <button value="cancel">閉じる</button>
        <button id="bReset" value="default">初期化</button>
      </div>
    </form>
  </dialog>

  <script>
    (() => {
      const $ = (q, p=document) => p.querySelector(q);
      const $$ = (q, p=document) => [...p.querySelectorAll(q)];

      const elTime = $('#time');
      const elSecs = $('#secs');
      const elDate = $('#date');
      const themeLabel = $('#themeLabel');
      const fmtLabel = $('#fmtLabel');
      const sheet = $('#settings');
      const card = $('#card');

      const state = {
        use24h: true,
        showSeconds: true,
        showDate: true,
        theme: 'theme-cyber',
      };

      const storeKey = 'stylish-clock:v1';
      try {
        const saved = JSON.parse(localStorage.getItem(storeKey) || '{}');
        Object.assign(state, saved);
      } catch {}

      function syncUI() {
        document.body.classList.remove('theme-cyber','theme-ink','theme-sunrise');
        document.body.classList.add(state.theme);
        themeLabel.textContent = (state.theme.split('-')[1] || 'CYBER').toUpperCase();
        fmtLabel.textContent = state.use24h ? '24H' : '12H';
        elSecs.style.display = state.showSeconds ? '' : 'none';
        elDate.style.display = state.showDate ? '' : 'none';
        // settings buttons
        $('#b12').setAttribute('aria-pressed', String(!state.use24h));
        $('#b24').setAttribute('aria-pressed', String(state.use24h));
        $('#bSecOn').setAttribute('aria-pressed', String(state.showSeconds));
        $('#bSecOff').setAttribute('aria-pressed', String(!state.showSeconds));
        $('#bDateOn').setAttribute('aria-pressed', String(state.showDate));
        $('#bDateOff').setAttribute('aria-pressed', String(!state.showDate));
        $$("[data-theme]").forEach(b => b.setAttribute('aria-pressed', String(b.dataset.theme === state.theme)));
      }

      function save() { localStorage.setItem(storeKey, JSON.stringify(state)); }

      const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

      function pad(n) { return n < 10 ? '0' + n : '' + n; }

      function formatDate(d) {
        const Y = d.getFullYear();
        const M = pad(d.getMonth()+1);
        const D = pad(d.getDate());
        const W = weekdays[d.getDay()];
        return `${Y}-${M}-${D} ${W}`;
      }

      // 高精度更新：requestAnimationFrameで秒境界を狙う
      let lastSec = -1;
      function tick() {
        const now = new Date();
        const ms = now.getMilliseconds();
        const sec = now.getSeconds();
        if (sec !== lastSec) {
          render(now);
          lastSec = sec;
        }
        // 次のフレームへ
        requestAnimationFrame(tick);
      }

      function render(d) {
        let h = d.getHours();
        let ampm = '';
        if (!state.use24h) {
          ampm = h >= 12 ? ' PM' : ' AM';
          h = h % 12; if (h === 0) h = 12;
        }
        const m = d.getMinutes();
        const s = d.getSeconds();
        const base = `${pad(h)}:${pad(m)}`;
        elTime.firstChild && elTime.removeChild(elTime.firstChild);
        elTime.insertAdjacentText('afterbegin', base);
        elSecs.textContent = state.showSeconds ? `:${pad(s)}` + (state.use24h ? '' : ampm) : (state.use24h ? '' : ampm);
        if (state.showDate) elDate.textContent = formatDate(d);
      }

      // 直感的操作: タップ/ダブルタップ/長押し
      let tapTimer = null, lastTap = 0, pressTimer = null;

      card.addEventListener('pointerdown', () => {
        pressTimer = setTimeout(() => { openSettings(); }, 420);
      });
      card.addEventListener('pointerup', () => {
        if (pressTimer) { clearTimeout(pressTimer); pressTimer = null; }
      });

      card.addEventListener('click', (e) => {
        const now = performance.now();
        if (now - lastTap < 260) { // double tap
          cycleTheme();
          lastTap = 0;
        } else {
          lastTap = now;
          if (tapTimer) clearTimeout(tapTimer);
          tapTimer = setTimeout(() => {
            state.showSeconds = !state.showSeconds; save(); syncUI();
          }, 250);
        }
      });

      function openSettings(){ sheet.showModal(); }

      // 設定操作
      $('#b12').addEventListener('click', () => { state.use24h = false; save(); syncUI(); });
      $('#b24').addEventListener('click', () => { state.use24h = true; save(); syncUI(); });
      $('#bSecOn').addEventListener('click', () => { state.showSeconds = true; save(); syncUI(); });
      $('#bSecOff').addEventListener('click', () => { state.showSeconds = false; save(); syncUI(); });
      $('#bDateOn').addEventListener('click', () => { state.showDate = true; save(); syncUI(); });
      $('#bDateOff').addEventListener('click', () => { state.showDate = false; save(); syncUI(); });

      $$("[data-theme]").forEach(btn => btn.addEventListener('click', () => {
        state.theme = btn.dataset.theme; save(); syncUI();
      }));

      $('#bReset').addEventListener('click', (e)=>{
        e.preventDefault();
        Object.assign(state, { use24h:true, showSeconds:true, showDate:true, theme:'theme-cyber' });
        save(); syncUI();
      });

      function cycleTheme(){
        const themes = ['theme-cyber','theme-ink','theme-sunrise'];
        const idx = themes.indexOf(state.theme);
        state.theme = themes[(idx+1)%themes.length];
        save(); syncUI();
      }

      // 画面常時点灯（対応ブラウザのみ）
      async function tryWakeLock(){
        try {
          if ('wakeLock' in navigator) {
            await navigator.wakeLock.request('screen');
          }
        } catch {}
      }

      // 初期化
      syncUI();
      render(new Date());
      requestAnimationFrame(tick);
      tryWakeLock();

      // iOSでのダブルタップズーム抑止（UX向上）
      document.addEventListener('gesturestart', e => e.preventDefault());
    })();
  </script>
</body>
</html>
